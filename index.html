<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f2f5; color: #333; padding: 15px; line-height: 1.5; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        .badge { background: #0088cc; color: white; padding: 5px 10px; border-radius: 5px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .price { color: #2ecc71; font-size: 22px; font-weight: bold; margin: 15px 0; }
        .ai-section { background: #eef9ff; border-left: 4px solid #0088cc; padding: 15px; margin-top: 15px; border-radius: 0 10px 10px 0; }
        #ai-text { font-style: normal; white-space: pre-wrap; font-size: 14px; color: #2c3e50; margin-top: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        tr { border-bottom: 1px solid #eee; }
        td { padding: 12px 0; }
        .label { color: #666; font-weight: 500; }
        .value { text-align: right; font-weight: bold; color: #333; }
        button { width: 100%; padding: 14px; background: #0088cc; color: white; border: none; border-radius: 12px; margin-top: 25px; font-size: 16px; font-weight: bold; cursor: pointer; transition: background 0.2s; }
        button:active { background: #006699; }
    </style>
</head>
<body>
    <div class="card">
        <span class="badge">PRO REJIM | AI TAHLIL</span>
        <h2 id="dori-nomi" style="margin: 10px 0 5px 0;">Yuklanmoqda...</h2>
        <p id="mnn" style="color: #666; font-size: 13px; margin: 0;"></p>
        
        <div class="price" id="narx"></div>
        
        <table>
            <tr>
                <td class="label">锔 Doza/Shakl:</td>
                <td id="doza" class="value"></td>
            </tr>
            <tr>
                <td class="label"> Ishlab chiqaruvchi:</td>
                <td id="zavod" class="value"></td>
            </tr>
        </table>

        <div class="ai-section">
            <strong style="color: #0088cc; display: flex; align-items: center; gap: 5px;">
                <span></span> AI Tibbiy Tahlili:
            </strong>
            <div id="ai-text">Ma'lumotlar tahlil qilinmoqda...</div>
        </div>

        <button onclick="Telegram.WebApp.close()">Sahifani yopish</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); 
        tg.ready();

        const params = new URLSearchParams(window.location.search);

        // Ma'lumotlarni o'qish va joylashtirish
        document.getElementById('dori-nomi').innerText = params.get('name') || 'Noma始lum dori';
        document.getElementById('mnn').innerText = params.get('mnn') || 'Tarkib ma始lumoti yo驶q';
        document.getElementById('doza').innerText = params.get('doza') || '-';
        document.getElementById('zavod').innerText = params.get('zavod') || 'Noma始lum zavod';
        document.getElementById('narx').innerText = (params.get('price') || '0') + " so'm";
        const aiRaw = params.get('ai_data');
        document.getElementById('ai-text').innerText = aiRaw ? decodeURIComponent(aiRaw) : "Tahlil topilmadi.";
        // AI ma'lumotini decode qilish (BU ENG MUHIM QISM)
        const rawAiData = params.get('ai_data');
        if (rawAiData) {
            try {
                // URL-kodlangan matnni o'zbek tilidagi holatiga qaytaradi
                document.getElementById('ai-text').innerText = decodeURIComponent(rawAiData);
            } catch (e) {
                document.getElementById('ai-text').innerText = "Ma始lumotni o驶qishda xatolik yuz berdi.";
            }
        } else {
            document.getElementById('ai-text').innerText = "Ushbu dori uchun AI tahlili mavjud emas.";
        }
    </script>
</body>
</html>